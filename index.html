<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Énigme du Collier – Kill Event</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    :root {
      --bg: #050505;
      --accent: #DA4F40;
      --gold: #D4AF37;
      --deep-red: #7B0C05;
      --text: #f5f5f5;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #1a1a1a 0, #000 45%, #000 100%);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .container {
      max-width: 900px;
      width: 100%;
      background: rgba(0, 0, 0, 0.9);
      border-radius: 20px;
      border: 1px solid rgba(212, 175, 55, 0.4);
      box-shadow:
        0 0 25px rgba(0, 0, 0, 0.9),
        0 0 40px rgba(212, 175, 55, 0.15),
        0 0 80px rgba(122, 12, 5, 0.35);
      padding: 30px 24px 28px;
      position: relative;
      overflow: hidden;
    }

    /* Halo décoratif */
    .container::before {
      content: "";
      position: absolute;
      inset: -120px;
      background:
        radial-gradient(circle at 0 0, rgba(122, 12, 5, 0.3), transparent 55%),
        radial-gradient(circle at 100% 0, rgba(218, 79, 64, 0.25), transparent 55%),
        radial-gradient(circle at 50% 100%, rgba(212, 175, 55, 0.2), transparent 60%);
      opacity: 0.7;
      pointer-events: none;
      z-index: -1;
    }

    header {
      display: flex;
      gap: 20px;
      align-items: center;
      justify-content: center;
      margin-bottom: 20px;
    }

    header img {
      height: 80px;
      width: auto;
      filter: drop-shadow(0 0 10px rgba(0, 0, 0, 0.8));
    }

    h1 {
      font-size: 1.9rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--gold);
      text-align: center;
      line-height: 1.2;
    }

    h1 span {
      display: block;
      font-size: 0.8rem;
      color: var(--accent);
      letter-spacing: 0.25em;
      margin-top: 6px;
    }

    p {
      line-height: 1.6;
    }

    .subtext {
      text-align: center;
      font-size: 0.9rem;
      opacity: 0.9;
      margin-bottom: 16px;
    }

    .section-title {
      font-size: 1.1rem;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      color: var(--deep-red);
      padding-left: 8px;
      position: relative;
      margin-bottom: 12px;
      margin-top: 10px;
    }

    .section-title::before {
      content: "";
      position: absolute;
      left: 0;
      top: 50%;
      width: 4px;
      height: 18px;
      background: linear-gradient(to bottom, var(--accent), var(--gold));
      transform: translateY(-50%);
      border-radius: 999px;
    }

    .panel {
      border-radius: 14px;
      border: 1px solid rgba(255, 255, 255, 0.06);
      background: radial-gradient(circle at top, rgba(255,255,255,0.05), rgba(0,0,0,0.9));
      padding: 16px 18px 18px;
      margin-bottom: 18px;
    }

    /* --- SECTION CODE SECRET --- */

    #gate-section {
      margin-bottom: 8px;
    }

    .code-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 10px;
      align-items: center;
    }

    .code-input {
      flex: 1;
      min-width: 120px;
      max-width: 200px;
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid rgba(212, 175, 55, 0.6);
      background: rgba(0, 0, 0, 0.85);
      color: var(--text);
      font-size: 1rem;
      text-align: center;
      letter-spacing: 0.2em;
    }

    .code-input:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 12px rgba(218, 79, 64, 0.5);
    }

    .btn {
      border: none;
      border-radius: 999px;
      padding: 10px 18px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      font-size: 0.78rem;
      cursor: pointer;
      background: linear-gradient(135deg, var(--gold), var(--accent));
      color: #000;
      white-space: nowrap;
      box-shadow:
        0 0 10px rgba(212, 175, 55, 0.5),
        0 0 25px rgba(0, 0, 0, 0.8);
      transition: transform 0.12s ease, box-shadow 0.12s ease, filter 0.12s ease;
    }

    .btn:hover {
      transform: translateY(-1px);
      filter: brightness(1.05);
      box-shadow:
        0 0 14px rgba(212, 175, 55, 0.7),
        0 0 32px rgba(0, 0, 0, 0.9);
    }

    .btn:active {
      transform: translateY(1px) scale(0.98);
      box-shadow: 0 0 8px rgba(0, 0, 0, 0.8);
    }

    .hint {
      font-size: 0.85rem;
      opacity: 0.8;
      margin-top: 6px;
    }

    .code-error {
      margin-top: 8px;
      font-size: 0.85rem;
      color: var(--accent);
      min-height: 1.1em;
    }

    /* --- SECTION ENIGME --- */

    #puzzle-section {
      display: none;
    }

    .story-text {
      font-size: 0.96rem;
      margin-bottom: 10px;
    }

    .warning {
      font-size: 0.9rem;
      color: var(--accent);
      font-weight: 600;
      margin-bottom: 4px;
    }

    .riddle-intro {
      font-size: 0.95rem;
      margin-bottom: 10px;
      opacity: 0.95;
    }

    .boxes-wrapper {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 14px;
      margin-top: 10px;
    }

    @media (max-width: 720px) {
      .boxes-wrapper {
        grid-template-columns: 1fr;
      }
      header {
        flex-direction: column;
      }
      header img {
        height: 70px;
      }
    }

    .box-card {
      position: relative;
      padding: 14px 12px 12px;
      border-radius: 16px;
      border: 1px solid rgba(212, 175, 55, 0.35);
      background: radial-gradient(circle at top, rgba(212,175,55,0.07), rgba(0,0,0,0.95));
      text-align: center;
      cursor: pointer;
      transition: transform 0.15s ease, box-shadow 0.15s ease, border-color 0.15s ease, background 0.15s ease;
      overflow: hidden;
    }

    .box-card::before {
      content: "";
      position: absolute;
      inset: -40%;
      background: radial-gradient(circle, rgba(218,79,64,0.1), transparent 60%);
      opacity: 0;
      transition: opacity 0.15s ease;
      pointer-events: none;
    }

    .box-card:hover {
      transform: translateY(-2px);
      box-shadow:
        0 0 20px rgba(0, 0, 0, 0.9),
        0 0 25px rgba(218, 79, 64, 0.35);
      border-color: rgba(218, 79, 64, 0.8);
      background: radial-gradient(circle at top, rgba(218,79,64,0.18), rgba(0,0,0,0.98));
    }

    .box-card:hover::before {
      opacity: 1;
    }

    .box-label {
      font-size: 0.75rem;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      color: rgba(212, 175, 55, 0.8);
      margin-bottom: 8px;
    }

    .box-illustration {
      height: 80px;
      margin-bottom: 8px;
      filter:
        drop-shadow(0 0 8px rgba(0,0,0,0.8))
        drop-shadow(0 0 14px rgba(212,175,55,0.25));
    }

    .box-text {
      font-size: 0.9rem;
      line-height: 1.4;
    }

    .box-text strong {
      color: var(--gold);
    }

    .mascot-footer {
      margin-top: 16px;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 8px;
      font-size: 0.85rem;
      opacity: 0.9;
    }

    .mascot-footer img {
      height: 40px;
      width: auto;
      filter: drop-shadow(0 0 8px rgba(0,0,0,0.9));
    }

    /* --- OVERLAY VERROUILLAGE --- */

    #lock-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.94);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      backdrop-filter: blur(3px);
    }

    .lock-inner {
      max-width: 420px;
      width: 90%;
      border-radius: 18px;
      border: 1px solid rgba(212, 175, 55, 0.6);
      background: radial-gradient(circle at top, rgba(212,175,55,0.1), #050505);
      padding: 22px 20px 20px;
      text-align: center;
      box-shadow:
        0 0 25px rgba(0,0,0,0.9),
        0 0 40px rgba(122,12,5,0.4);
    }

    .lock-title {
      font-size: 1.05rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: var(--deep-red);
      margin-bottom: 10px;
    }

    .lock-text {
      font-size: 0.95rem;
      margin-bottom: 10px;
    }

    .lock-timer {
      font-family: "SF Mono", Menlo, Consolas, monospace;
      font-size: 1.4rem;
      letter-spacing: 0.18em;
      color: var(--gold);
      margin-top: 2px;
    }

    .lock-sub {
      font-size: 0.8rem;
      margin-top: 8px;
      opacity: 0.85;
    }

  </style>
</head>
<body>
  <div id="lock-overlay">
    <div class="lock-inner">
      <div class="lock-title">Piège déclenché</div>
      <div class="lock-text">
        Vous avez ouvert la mauvaise boîte.<br>
        Le mécanisme se referme brutalement… ⏳
      </div>
      <div>Vous devrez patienter avant de retenter votre chance.</div>
      <div class="lock-timer" id="lock-timer">05:00</div>
      <div class="lock-sub">
        Impossible de cliquer sur quoi que ce soit pendant ce délai.<br>
        Observez bien les phrases sur les boîtes…
      </div>
    </div>
  </div>

  <main class="container">
    <header>
      <img src="https://cdn.shopify.com/s/files/1/0726/0690/8753/files/kill_event_google_db75b104-5605-44cb-862c-9b2d1d5261a0.png?v=1730289271" alt="Logo Kill Event">
      <div>
        <h1>
          Énigme du Collier Perdu
          <span>Kill Event · Chambre Forte</span>
        </h1>
      </div>
    </header>

    <!-- SECTION CODE SECRET -->
    <section id="gate-section" class="panel">
      <h2 class="section-title">Accès sécurisé</h2>
      <p class="subtext">
        Pour accéder à la chambre forte, saisissez le <strong>code secret</strong> trouvé précédemment.
      </p>
      <div class="code-row">
        <input
          type="password"
          id="secret-code"
          class="code-input"
          maxlength="4"
          placeholder="_ _ _ _"
          autocomplete="off"
        >
        <button class="btn" id="validate-code">Valider le code</button>
      </div>
      <div class="hint">
        Un code à <strong>4 chiffres</strong>… si vous avez bien enquêté, vous le connaissez déjà.
      </div>
      <div id="code-error" class="code-error"></div>
    </section>

    <!-- SECTION ENIGME -->
    <section id="puzzle-section" class="panel">
      <h2 class="section-title">La porte se referme…</h2>
      <p class="story-text">
        Bravo, vous avez trouvé le code permettant d'accéder au collier…<br>
        <strong>MAIS</strong> la porte derrière vous s’est refermée.
      </p>
      <p class="story-text">
        Pour trouver la clé, vous devez résoudre l’énigme ci-dessous.<br>
      </p>
      <p class="warning">
        ⚠️ Attention : si vous vous trompez, vous devrez attendre <strong>5 minutes</strong>
        avant de pouvoir cliquer sur une autre boîte.
      </p>

      <p class="riddle-intro">
        Trois boîtes se dressent devant vous. <br>
        <strong>Une seule</strong> contient la clé, les deux autres cachent un piège. <br>
        Sur chaque boîte est inscrite une phrase… et <strong>une seule de ces phrases est vraie</strong>.
      </p>

      <div class="boxes-wrapper">
        <!-- Boîte 1 -->
        <div class="box-card" data-box="1">
          <div class="box-label">Boîte 1</div>
          <img
            class="box-illustration"
            src="https://cdn.shopify.com/s/files/1/0726/0690/8753/files/black-box.png?v=1764756283"
            alt="Boîte mystérieuse 1"
          >
          <div class="box-text">
            <strong>« La clé se trouve ici. »</strong>
          </div>
        </div>

        <!-- Boîte 2 (BONNE) -->
        <div class="box-card" data-box="2">
          <div class="box-label">Boîte 2</div>
          <img
            class="box-illustration"
            src="https://cdn.shopify.com/s/files/1/0726/0690/8753/files/black-box.png?v=1764756283"
            alt="Boîte mystérieuse 2"
          >
          <div class="box-text">
            <strong>« Rien n'est ici. »</strong>
          </div>
        </div>

        <!-- Boîte 3 -->
        <div class="box-card" data-box="3">
          <div class="box-label">Boîte 3</div>
          <img
            class="box-illustration"
            src="https://cdn.shopify.com/s/files/1/0726/0690/8753/files/black-box.png?v=1764756283"
            alt="Boîte mystérieuse 3"
          >
          <div class="box-text">
            <strong>« La clé ne se trouve pas ici. »</strong>
          </div>
        </div>
      </div>

      <div class="mascot-footer">
        <img
          src="https://cdn.shopify.com/s/files/1/0726/0690/8753/files/mascotte_fond_transparent-min.png?v=1760630439"
          alt="Jack Event"
        >
        <span>Jack Event vous observe… choisissez bien votre boîte.</span>
      </div>
    </section>
  </main>

  <script>
    // ----- CONSTANTES -----
    const SECRET_CODE = "9875";
    const LOCK_DURATION_MS = 5 * 60 * 1000; // 5 minutes
    const LOCK_KEY = "killEventBoxLockUntil";

    const gateSection = document.getElementById("gate-section");
    const puzzleSection = document.getElementById("puzzle-section");
    const codeInput = document.getElementById("secret-code");
    const validateBtn = document.getElementById("validate-code");
    const codeError = document.getElementById("code-error");

    const lockOverlay = document.getElementById("lock-overlay");
    const lockTimerDisplay = document.getElementById("lock-timer");

    let lockIntervalId = null;

    // ----- GESTION DU CODE SECRET -----
    function checkSecretCode() {
      const value = (codeInput.value || "").trim();
      if (value === SECRET_CODE) {
        codeError.textContent = "";
        gateSection.style.display = "none";
        puzzleSection.style.display = "block";
      } else {
        codeError.textContent = "Mauvais code. Le système refuse l’accès à la chambre forte.";
      }
    }

    validateBtn.addEventListener("click", checkSecretCode);
    codeInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        checkSecretCode();
      }
    });

    // ----- LOCK / DEVERROUILLAGE -----

    function formatTime(msRemaining) {
      const totalSeconds = Math.max(0, Math.floor(msRemaining / 1000));
      const minutes = String(Math.floor(totalSeconds / 60)).padStart(2, "0");
      const seconds = String(totalSeconds % 60).padStart(2, "0");
      return `${minutes}:${seconds}`;
    }

    function applyLock(lockUntil) {
      // Affiche l'overlay + timer
      lockOverlay.style.display = "flex";

      if (lockIntervalId) {
        clearInterval(lockIntervalId);
      }

      function updateTimer() {
        const now = Date.now();
        const remaining = lockUntil - now;

        if (remaining <= 0) {
          clearInterval(lockIntervalId);
          lockIntervalId = null;
          localStorage.removeItem(LOCK_KEY);
          lockOverlay.style.display = "none";
          return;
        }

        lockTimerDisplay.textContent = formatTime(remaining);
      }

      updateTimer();
      lockIntervalId = setInterval(updateTimer, 1000);
    }

    function startLock() {
      const lockUntil = Date.now() + LOCK_DURATION_MS;
      localStorage.setItem(LOCK_KEY, String(lockUntil));
      applyLock(lockUntil);
    }

    function checkExistingLock() {
      const stored = localStorage.getItem(LOCK_KEY);
      if (!stored) return;

      const lockUntil = Number(stored);
      if (Number.isNaN(lockUntil)) {
        localStorage.removeItem(LOCK_KEY);
        return;
      }

      const now = Date.now();
      if (lockUntil > now) {
        applyLock(lockUntil);
      } else {
        localStorage.removeItem(LOCK_KEY);
      }
    }

    // ----- CLIC SUR LES BOÎTES -----
    function onBoxClick(boxElement) {
      const stored = localStorage.getItem(LOCK_KEY);
      const now = Date.now();

      // Si verrou en cours, on ne fait rien (overlay bloque déjà les clics)
      if (stored && Number(stored) > now) {
        return;
      }

      const boxId = boxElement.dataset.box;
      if (boxId === "2") {
        // Bonne boîte → redirection vers le site Kill Event
        window.location.href = "https://killevent.github.io/enigme-finale2/";
      } else {
        // Mauvaise boîte → démarrer le blocage
        startLock();
      }
    }

    document.querySelectorAll(".box-card").forEach((box) => {
      box.addEventListener("click", () => onBoxClick(box));
    });

    // Vérifier à l'ouverture si un verrou est déjà actif
    checkExistingLock();
  </script>
</body>
</html>

